<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Controle de Demurrage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="index.css">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.20.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="p-4 md:p-8 bg-slate-100 dark:bg-slate-900">
    <div id="history-banner" class="hidden fixed top-0 left-0 right-0 bg-yellow-400 dark:bg-yellow-600 text-black dark:text-white p-2 text-center text-sm font-semibold z-[100] shadow-lg">
        <span id="history-banner-text"></span>
        <button id="return-to-live-btn" class="ml-4 underline font-bold hover:text-blue-700 dark:hover:text-blue-300" data-translate-key="return_to_live_btn">Voltar à visualização atual</button>
    </div>
    <div class="max-w-full mx-auto">
        
                <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <div>
                <h1 class="text-3xl font-extrabold text-gray-800 dark:text-slate-100" data-translate-key="main_title">DASHBOARD DE CONTROLE DE DEMURRAGE</h1>
                <p id="last-update" class="text-gray-500 dark:text-slate-400 mt-1" data-translate-key="upload_prompt_initial">Carregue sua planilha para começar</p>
            </div>
            <div class="flex items-center space-x-2 mt-4 md:mt-0">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <i class="fas fa-search text-gray-400 dark:text-slate-500"></i>
                    </span>
                    <input type="search" id="global-search-input" data-translate-key="global_search_placeholder" placeholder="Search all details..." class="pl-10 w-64 block rounded-lg border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700/50 dark:text-slate-200 shadow-md focus:border-blue-500 focus:ring-blue-500 h-[44px] transition-all duration-300 focus:w-80">
                </div>
                 <div class="flex items-center space-x-0 rounded-lg shadow-md">
                    <button id="history-btn" class="hidden cursor-pointer bg-cyan-600 hover:bg-cyan-700 dark:bg-cyan-700 dark:hover:bg-cyan-600 text-white px-4 h-[44px] rounded-l-lg transition-all duration-300 font-semibold flex items-center" title="Histórico">
                        <i class="fas fa-history"></i>
                    </button>
                    <button id="settings-btn" class="hidden cursor-pointer bg-gray-500 hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-500 text-white px-4 h-[44px] transition-all duration-300 font-semibold flex items-center" title="Configurações">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="clear-data-btn" class="hidden cursor-pointer bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-500 text-white px-4 h-[44px] rounded-r-lg transition-all duration-300 font-semibold flex items-center">
                        <i class="fas fa-trash-alt mr-2"></i> <span data-translate-key="clear_data_btn">Limpar Dados</span>
                    </button>
                </div>
                <div class="flex items-center space-x-2 rounded-lg shadow-md">
                    <button id="translate-btn" class="cursor-pointer bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white px-4 h-[44px] rounded-l-lg transition-all duration-300 font-semibold flex items-center">
                        <i class="fas fa-language mr-2"></i> <span id="translate-btn-text">中文</span>
                    </button>
                    <button id="theme-toggle-btn" class="cursor-pointer bg-slate-700 hover:bg-slate-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white px-4 h-[44px] rounded-r-lg transition-all duration-300 font-semibold flex items-center w-[52px] justify-center">
                        <i id="theme-toggle-icon" class="fas fa-moon"></i>
                    </button>
                </div>
          _       <button id="ai-insights-btn" class="hidden cursor-pointer bg-purple-600 hover:bg-purple-700 dark:bg-purple-500 dark:hover:bg-purple-400 text-white px-4 h-[44px] rounded-lg shadow-md transition-all duration-300 font-semibold flex items-center">
                    <i class="fas fa-magic mr-2"></i> <span data-translate-key="ai_insights_btn">AI Insights</span>
                </button>
                <label for="file-upload" class="cursor-pointer bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-400 text-white px-4 py-2.5 rounded-lg shadow-md transition-all duration-300 font-semibold flex items-center h-[44px]">
                    <i class="fas fa-upload mr-2"></i> <span data-translate-key="upload_btn">Carregar XLSX</span>
                </label>
                <input id="file-upload" type="file" class="hidden" accept=".xlsx, .xls">
            </div>
        </header>

                <div id="filter-container" class="hidden bg-white dark:bg-slate-800 p-4 rounded-lg shadow mb-6">
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 xl:grid-cols-12 gap-4 items-start">
                <div class="lg:col-span-1 xl:col-span-2">
                    <label for="po-filter" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_po">Filtrar POs</label>
                    <select id="po-filter" multiple class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm h-24"></select>
                </div>
                <div class="lg:col-span-1 xl:col-span-2">
                    <label for="vessel-filter" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_vessel">Filtrar Navios</label>
                    <input type="text" id="vessel-search-input" placeholder="Pesquisar..." class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm text-sm p-2 mb-1" data-translate-key="vessel_search_placeholder" />
                    <select id="vessel-filter" multiple class="block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm h-20"></select>
                </div>
                 <div class="lg:col-span-1 xl:col-span-2">
                    <label for="container-filter" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_container">Filtrar Contêiner</label>
                    <input type="text" id="container-search-input" placeholder="Pesquisar..." class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm text-sm p-2 mb-1" data-translate-key="vessel_search_placeholder">
                    <select id="container-filter" multiple class="block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm h-20"></select>
                </div>
                 <div class="lg:col-span-1 xl:col-span-1">
                    <label for="final-status-filter" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_final_status">Status Final</label>
                    <select id="final-status-filter" multiple class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm h-24"></select>
                </div>
                <div class="lg:col-span-1 xl:col-span-1">
              _       <label for="loading-type-filter" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_loading_type">Tipo Carregamento</label>
                    <select id="loading-type-filter" multiple class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm h-24"></select>
                </div>
                 <div class="lg:col-span-1 xl:col-span-1">
                    <label for="cargo-type-filter" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_cargo_type">Tipo de Carga</label>
                    <select id="cargo-type-filter" multiple class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm h-24"></select>
                </div>
                <div class="lg:col-span-1 xl:col-span-3">
                    <label for="shipowner-filter" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_shipowner">Armador (Shipowner)</label>
                    <input type="text" id="shipowner-search-input" placeholder="Pesquisar..." class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm text-sm p-2 mb-1" data-translate-key="vessel_search_placeholder" />
                    <select id="shipowner-filter" multiple class="block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm h-20"></select>
                </div>

                <div class="col-span-full mt-4 pt-4 border-t border-gray-200 dark:border-slate-700 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 items-end">
                    <div>
                        <label for="arrival-start-date" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_arrival_start">Início da Chegada</label>
                        <input type="date" id="arrival-start-date" class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm p-1.5 text-sm">
                    </div>
                    <div>
                        <label for="arrival-end-date" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_arrival_end">Fim da Chegada</label>
                        <input type="date" id="arrival-end-date" class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm p-1.5 text-sm">
                    </div>
                    <div>
                        <label for="freetime-start-date" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_freetime_start">Início do FreeTime</label>
                        <input type="date" id="freetime-start-date" class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm p-1.5 text-sm">
e               </div>
                    <div>
                        <label for="freetime-end-date" class="block text-sm font-medium text-gray-700 dark:text-slate-300" data-translate-key="filter_freetime_end">Fim do FreeTime</label>
                        <input type="date" id="freetime-end-date" class="mt-1 block w-full rounded-md border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 shadow-sm p-1.5 text-sm">
                    </div>
                    <div class="lg:col-span-2 flex items-center space-x-2">
                        <button id="apply-filters-btn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-blue-700 font-semibold flex items-center justify-center">
                            <i class="fas fa-filter mr-2"></i> <span data-translate-key="filter_btn">Filtrar</span>
                        </button>
                        <button id="reset-filters-btn" class="w-full bg-gray-500 text-white px-4 py-2 rounded-md shadow-sm hover:bg-gray-600 font-semibold flex items-center justify-center">
                            <i class="fas fa-undo mr-2"></i> <span data-translate-key="clear_btn">Limpar</span>
                        </button>
                    </div>
                </div>
data-translate-key="filter_freetime_start">Início           </div>
        </div>

                <div id="main-content-area" class="hidden">
                        <div class="mb-6 border-b border-gray-200 dark:border-slate-700">
                <nav class="flex space-x-4 -mb-px" aria-label="Tabs">
                    <button class="tab-btn active-tab" data-tab="dashboard">
tools-span" data-translate-key="tab_analytics">Analytics</span>
                    <button class="tab-btn" data-tab="paid-demurrage">
                        <i class="fas fa-money-check-alt mr-2"></i><span data-translate-key="tab_paid_demurrage">Demurrage Pago</span>
                    </button>
                </nav>
            </div>
            
            Atenção (VENCE ≤ 30 DIAS)</p>
                        <p id="attention-count" class="text-4xl font-extrabold text-yellow-600">0</p>
                        <p class="text-xs text-gray-500 dark:text-slate-400" data-translate-key="kpi_attention_subtitle">Contêineres com prazo vencendo</p>
                    </div>
                    <div class="kpi-card p-5" data-kpi-category="returned">
                        <p class="text-sm font-medium text-green-600" data-translate-key="kpi_returned_title">Devolvidos no Prazo</p>
                        <p id="returned-count" class="text-4xl font-extrabold text-green-600">0</p>
section>
                    </div>
                     <div class="kpi-card p-5">
                        <p class="text-sm font-medium text-gray-600 dark:text-slate-300" data-translate-key="kpi_cost_title">Custo Total de Demurrage</p>
                        <p id="total-cost" class="text-4xl font-extrabold text-gray-800 dark:text-slate-100">$0</p>
                        <p class="text-xs text-gray-500 dark:text-slate-400" data-translate-key="kpi_cost_subtitle">*Custo de contêineres ativos e já devolvidos</p>
                    </div>
  section-break>
                    <div id="col-demurrage">
section-break>
                    </div>
                </main>
            </div>
            <div id="tab-panel-analytics" class="tab-panel hidden">
                <div id="analytics-content" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow">
                         <h3 class="text-lg font-bold text-gray-800 dark:text-slate-100 mb-4" data-translate-key="chart_title_cost_analysis">Análise de Custos: Real vs. Risco Gerenciado</h3>
section-break>
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow">
                         <h3 class="text-lg font-bold text-gray-800 dark:text-slate-100 mb-4" data-translate-key="chart_title_operational_efficiency">Eficiência Operacional</h3>
                        <div class="h-80 relative">
                            <canvas id="operationalPerformanceChart"></canvas>
                        </div>
                        <p id="performance-summary-text" class="mt-4 text-center text-sm text-gray-600 dark:text-slate-400"></p>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-slate-100 mb-4" data-translate-key="chart_title_demurrage_by_shipowner">Custo de Demurrage por Armador</h3>
                        <div class="h-80 relative">
                             <canvas id="demurrageByShipownerChart"></canvas>
section-break>
                </div>
                 <div id="analytics-placeholder" class="hidden text-center py-20 bg-white dark:bg-slate-800 rounded-lg shadow">
                    <i class="fas fa-chart-line text-6xl text-gray-300 dark:text-slate-600 mb-4"></i>
                    <h2 class="text-2xl font-semibold text-gray-600 dark:text-slate-300" data-translate-key="analytics_placeholder_title">Análise Indisponível</h2>
                    <p class="text-gray-400 dark:text-slate-500" data-translate-key="analytics_placeholder_subtitle">Filtros atuais não retornaram dados para análise.</p>
                </div>
            </div>
             <div id="tab-panel-paid-demurrage" class="tab-panel hidden">
                                <div id="paid-demurrage-summary" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                     <div class="kpi-card p-5">
                        <p class="text-sm font-medium text-red-600" data-translate-key="summary_total_cost_returned">Custo Total (Devolvidos)</p>
                        <p id="summary-total-cost" class="text-4xl font-extrabold text-red-600">_</p>
                    </div>
                     <div class="kpi-card p-5">
s="modal-content-wrapper max-w-6xl">
            <div class="p-4 border-b border-gray-200 dark:border-slate-700 flex justify-between items-center flex-shrink-0">
                <div class="flex-grow">
                    <h2 id="list-modal-title" class="text-2xl font-bold text-gray-800 dark:text-slate-100">Detalhes da Categoria</h2>
                </div>
                <div class="relative flex-shrink-0 mx-4">
  ax"></i></button>
            </div>
            <div id="rates-modal-body" class="p-6 flex-grow overflow-y-auto space-y-4"></div>
            <div class="p-4 border-t border-gray-200 dark:border-slate-700 flex justify-end items-center space-x-3">
section-break>
                <button id="rates-modal-save-btn" class="bg-blue-600 text-white px-5 py-2 rounded-md shadow-sm hover:bg-blue-700 font-semibold" data-translate-key="save_btn">Salvar</button>
            </div>
        </div>
    </div>

  s="modal-content-wrapper max-w-3xl">
            <div class="p-4 border-b border-gray-200 dark:border-slate-700 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-slate-100" data-translate-key="ai_modal_title">AI Generated Insights</h2>
                <button id="ai-modal-close-btn" class="text-gray-400 dark:text-slate-500 hover:text-gray-600 dark:hover:text-slate-300"><i class="fas fa-times fa-2x"></i></button>
* <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
        <script src="index.tsx" type="module"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
